# 阿里云httpdns错误处理思路

用户业务使用HTTPDNS时，应做好异常情况下的出错兼容逻辑，主要包括异步请求、重试和降级。

异步请求
访问HTTPDNS服务时，应该使用异步请求的策略，避免解析延迟太大而对业务造成影响，特别是在网络环境异常或HTTPDNS服务IP异常不可用时，如果用同步访问，需要等待网络超时后才会返回解析失败，这个超时时间较大，可能对业务的使用体验造成很大影响。

异步请求策略：解析域名时，如果当前缓存中有TTL未过期的IP，可直接使用；如果没有，则立刻让此次请求降级走原生LocalDNS解析，同时另起线程异步地发起HTTPDNS请求进行解析，更新缓存，这样后续解析域名时就能命中缓存。

重试
访问HTTPDNS服务解析域名时，如果请求HTTPDNS服务端失败，即HTTP请求没有返回，可以进行重试。

大部分情况下，这种访问失败是由于网络原因引起的，重试可以解决。

降级
不管是因为什么原因，当通过HTTPDNS服务无法获得域名对应的IP时，都必须降级：使用标准的DNS解析，通过Local DNS去解析域名。

如上所述，请求HTTPDNS但没有返回IP时，主要是因为“域名没有在控制台添加”或“域名本身不存在”，无论如何，如果通过HTTPDNS没有解析出IP，为保证业务请求正常，必须“降级”使用标准的DNS，作为一种兜底的方案。